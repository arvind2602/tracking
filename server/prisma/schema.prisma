generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model organiation {
  id        String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  createdAt DateTime   @default(now())
  updatedAt DateTime?  @updatedAt
  employees employee[]
  projects  projects[]
  sites     Site[]
}

model employee {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstName     String
  lastName      String
  email         String      @unique
  position      String
  role          role
  createdAt     DateTime    @default(now())
  updatedAt     DateTime?   @updatedAt
  is_archived   Boolean     @default(false)
  organiationId String      @db.Uuid
  password      String
  lastDeviceId  String?
  comments      comment[]
  timeLogs      TimeLog[]
  organiation   organiation @relation(fields: [organiationId], references: [id])
}

model TimeLog {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId  String    @db.Uuid
  employee    employee  @relation(fields: [employeeId], references: [id])
  checkIn     DateTime  @default(now())
  checkOut    DateTime?
  type        LogType   @default(WORK)
  reason      String?
  latitude    Float?
  longitude   Float?
  deviceId    String?
  deviceType  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt
}

enum LogType {
  WORK
  LUNCH
  BREAK
  WASHROOM
  PERSONAL_EMERGENCY
  HOME
  OTHER
}


model projects {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String
  description   String
  startDate     DateTime
  endDate       DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime?   @updatedAt
  is_archived   Boolean     @default(false)
  organiationId String      @db.Uuid
  organiation   organiation @relation(fields: [organiationId], references: [id])
  task          task[]
}

model task {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  description String
  status      String
  createdBy   String
  assignedTo  String?
  assigned_at DateTime?
  points      Float
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt
  projectId   String    @db.Uuid
  comments    comment[]
  project     projects  @relation(fields: [projectId], references: [id])
  priority    Priority  @default(MEDIUM)
  dueDate     DateTime?
  order       Int       @default(0)
  completedAt DateTime?
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

model comment {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content   String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  taskId    String    @db.Uuid
  authorId  String    @db.Uuid
  author    employee  @relation(fields: [authorId], references: [id])
  task      task      @relation(fields: [taskId], references: [id])
}

enum role {
  ADMIN
  USER
}

model Site {
  id             String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String
  description    String?
  latitude       Float
  longitude      Float
  organizationId String      @db.Uuid
  createdAt      DateTime    @default(now())
  updatedAt      DateTime?   @updatedAt
  organiation    organiation @relation(fields: [organizationId], references: [id])
}
